<!DOCTYPE html>
<html>

<head>
	<style>
		.button {
			background-color: #008CBA;
			color: white;
			border: 2px solid #008CBA;
			border-radius: 4px;
			padding: 10px 24px;
		}
		.button:hover {
			background-color: #015774;
			border: 2px solid #015774;
			box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24),0 17px 50px 0 rgba(0,0,0,0.19);
		}
	</style>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>Experiment Dashboard</title>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body class="nav-fixed bg-light" id="page-top">
	<div class="container">
		<nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
			<div class="container-fluid">
				<a class="navbar-brand mx-auto text-primary">
					Experiment Preview
				</a>
			</div>
		</nav>
		<br />
		<div class="container-xxl position-relative d-flex p-0">
			<div class="container">
				<div class="row">
					<div class="col col-xl-8 col-lg-7">
						<div class="card shadow mb-4">
							<div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
								<h6 class="m-0 font-weight-bold text-primary">Experiment Progress</h6>
							</div>
							<div class="card-body">
								<div style="height: 20rem; width: 100%; position: relative">
									<canvas id="temperatureChart" />
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-4 col-lg-5">
						<div class="card shadow mb-4">
							<div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
								<h6 class="m-0 font-weight-bold text-primary">Experiment Mnagement</h6>
							</div>
							<div class="card-body">
								<div style="height: 20rem; width: 100%; position: relative; box-sizing: border-box;">
									<div>
										Experimentul este oprit!
									</div>
									<div style="padding-top: 1.5rem!important; padding-bottom: 0.5rem!important">
										<form action="/" method="POST">
											<div class="form-group">
												<label for="sel1">Select experiment:</label>
												<select name="sel1" class="form-control" id="sel1">
													<option value="1">Experiment 1</option>
													<option value="2">Experiment 2</option>
													<option value="3">Experiment 3</option>
												</select>
											</div>
											<br />
											<input type="submit" class="button" name="start_process" value="Incepe procesul" />
											<input type="submit" class="button" name="stop_process" value="Incheie procesul" />
										</form>
									</div>
								</div>
							</div>
						</div>
						<div style="clear: both" />
					</div>
				</div>
			</div>
			<br />
			<div class="row">
				<div class="col">
					<div class="card shadow mb-4">
						<div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
							<h6 class="m-0 font-weight-bold text-primary">Past Experiments</h6>
							<form action="/" method="POST">
								<input type="submit" class="button" name="display_table" value="Afiseaza toate experimentele!" />
							</form>
						</div>	
						<div class="bg-white card-body">	
							<div class="container-fluid px-4">		
								<div class="text-center rounded">
									<div class="table-responsive">
										<table class="table text-start align-middle table-bordered table-hover mb-0">
										    <thead>
    											<tr class="text-dark">
	    											<th>ID</th>
		    										<th>Start time</th>
			    									<th>Stop time</th>
				    								<th>Aborted</th>
					    						</tr>
					    				    </thead>
					    				    <tbody id="table_body">
					    				    </tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>	
	<a class="scroll-to-top rounded" href="#page-top" style="display: inline;">
        <i class="bi bi-arrow-up"></i>
    </a>

	<!-- Chart.js: www.chartjs.org -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.8.0/chart.min.js"></script>
	<script type="text/javascript">
		const ctx = document.getElementById('temperatureChart').getContext('2d');
		let chart = null;
		setInterval(async function () {
			let response = await fetch('/temps')
			let temps = await response.json();

			if (chart != null) {
				// Chart must be destroyed before creating new one
				chart.destroy();
			}
			chart = new Chart(ctx, {
				type: 'line',
				data: {
					labels: temps.map(x => x[4]),
					datasets: [
						{
							label: 'Senzor 1',
							data: temps.map(x => x[0]),
							pointRadius: 0
						},
						{
							label: 'Senzor 2',
							data: temps.map(x => x[1]),
							pointRadius: 0
						}
					],
				},
				options: {
					scales: {
						y: {
							max: 30,
							min: -20
						}
					},
					animation: false
				}
			});
		}, 5000);

        setInterval(async function () {
			let response = await fetch('/experiments')
			let exps = await response.json();
			console.log(exps);

			let tbody = document.getElementById('table_body');
			let html = '';
			for (let i = 0; i < exps.length; i++) {
			    html += '<tr><td>' + exps[i].id + '</td><td>' + exps[i].time_start + '</td><td>' + exps[i].time_end + '</td></tr>'
			}
			tbody.innerHTML = html;

			// Daca ruleaza un experiment
			// marcheaza butonul ca disabled
	    }, 500);
		
	</script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
		crossorigin="anonymous"></script>
</body>

</html>
